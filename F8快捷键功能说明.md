# VS Code F8 终端执行器

## 项目背景

在使用 VS Code 进行开发时，我们经常需要在终端中执行代码片段或命令。传统的方式需要多个步骤：选中文本、复制、切换到终端、粘贴、按回车执行。这个过程繁琐且耗时，特别是当需要频繁执行不同命令时。

本项目通过 Hammerspoon 实现了一个简单的快捷键功能，只需按下 F8 键，即可自动完成整个流程，大大提高工作效率。

## 创建过程

### 1. 需求分析

最初的需求是在 VS Code 中实现一个功能：选中代码 → 按下快捷键 → 代码自动在终端中执行。

我们尝试了多种方法：
- 使用 VS Code 扩展（Terminal-Paste-Runner）
- 使用 Automator 创建服务
- 使用 AppleScript 脚本

但这些方法都存在各种限制和问题，最终我们选择了 Hammerspoon 作为解决方案。

### 2. 安装 Hammerspoon

1. 从 [Hammerspoon 官网](https://www.hammerspoon.org/) 下载最新版本
2. 解压并将应用拖到应用程序文件夹
3. 启动 Hammerspoon 并授予必要的权限

### 3. 编写脚本

我们创建了一个 Lua 脚本，实现以下功能：
- 检测当前应用是否为 VS Code
- 复制选中的文本
- 打开/聚焦终端
- 粘贴文本并执行
- 提供视觉和声音反馈

### 4. 配置和测试

1. 将脚本保存到 `~/.hammerspoon/init.lua`
2. 重新加载 Hammerspoon 配置
3. 在 VS Code 中测试功能
4. 根据测试结果调整脚本参数（如延迟时间）

## 功能说明

### 核心功能

按下 F8 键时，脚本会：

1. **检查应用**：确认当前应用是否为 VS Code
2. **复制文本**：自动执行复制操作（Command+C）
3. **打开终端**：使用 VS Code 的内置终端快捷键（Ctrl+`）
4. **执行命令**：粘贴文本并按回车执行
5. **提供反馈**：显示通知并播放声音

### 错误处理

脚本包含多种错误处理机制：
- 如果当前不在 VS Code 中，显示提示并退出
- 如果没有选中文本，显示错误通知并播放错误声音
- 保存原始剪贴板内容，避免意外覆盖

### 用户反馈

- 成功执行时显示通知，包含执行的命令预览
- 播放成功/失败的声音反馈
- 在状态栏显示加载成功通知

## 使用方法

### 基本使用

1. 在 VS Code 中选中要执行的代码或命令
2. 按下 F8 键
3. 代码将自动在终端中执行

### 注意事项

- 如果 F8 键被系统用作媒体键，可能需要按 Fn+F8
- 或者在系统偏好设置 > 键盘中，勾选"将 F1、F2 等键用作标准功能键"
- 确保 VS Code 中已打开终端（如果没有，脚本会尝试打开）

### 自定义

如果需要自定义脚本，可以修改以下参数：
- 快捷键：修改 `hs.hotkey.bind({}, "f8", function()` 中的 "f8"
- 延迟时间：调整 `hs.timer.usleep()` 中的值
- 通知样式：修改 `showNotification()` 函数

## 技术细节

### 使用的 Hammerspoon API

- `hs.application`：获取和控制应用程序
- `hs.pasteboard`：访问系统剪贴板
- `hs.eventtap`：模拟键盘输入
- `hs.timer`：控制延迟和定时
- `hs.notify`：显示系统通知
- `hs.sound`：播放系统声音

### 脚本结构

1. **初始化**：定义辅助函数和变量
2. **快捷键绑定**：将 F8 键绑定到主函数
3. **应用检查**：验证当前环境
4. **文本处理**：复制和获取文本
5. **终端交互**：发送命令到终端
6. **用户反馈**：提供操作结果反馈

## 总结

这个简单而强大的工具极大地提高了在 VS Code 中执行命令的效率。通过一个按键，替代了原本需要多个步骤的操作流程，使开发过程更加流畅。

虽然实现方式看似简单，但它解决了一个实际的痛点问题，展示了如何通过自动化工具改善日常工作流程。
